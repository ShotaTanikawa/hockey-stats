# 運用手順書（MVP）

このドキュメントは、実運用に必要な最低限のルールと手順をまとめる。

---

## 1. 役割と責任

- **運用責任者（staff）**
  - メンバー昇格の承認
  - 招待コードの配布
  - 週次バックアップ
  - 重大障害時の判断

---

## 2. 招待コード運用（1回限り）

### 2-1. 発行手順

1. ダッシュボードの「チームメンバー」カードを開く
2. 「招待コードを発行」を押す
3. 表示されたコードをコピーして共有

### 2-2. 配布ルール

- **配布対象**: チーム関係者に限定
- **共有方法**: 原則、直接連絡（DM / 口頭）
- **禁止**: 公開SNS・掲示板での共有
- **期限**: 1回使用で自動失効
- **漏洩時**: 直ちに新しい招待コードを発行し、旧コードは無効化済みとして扱う

---

## 3. staff 昇格ルール

### 3-1. 承認基準

- チーム運用に関与するスタッフのみ
- 既存 staff 1名以上の承認

### 3-2. 昇格手順

1. ダッシュボード「チームメンバー」で対象ユーザーを確認
2. 「昇格」を押す
3. 反映を確認

---

## 4. 試合確定/再開封

### 4-1. 確定ルール

- 試合後修正が完了したら staff が試合を「確定」する
- 確定済み試合はライブ入力と試合後修正をロックする

### 4-2. 再開封ルール

- 誤入力修正が必要な場合のみ再開封
- 再開封後は修正完了後に再度「確定」する

---

## 5. バックアップ/復旧（Freeプラン前提）

### 5-1. バックアップ方針

- **頻度**: 週1回（推奨: 日曜夜）
- **保存先**: ローカル + クラウド（Google Drive等）
- **保管期間**: 4週間

### 5-2. 手動バックアップ手順

1. Supabase Dashboard にログイン
2. プロジェクト → Database
3. エクスポート機能でバックアップを取得
4. ファイル名に日付を付けて保存

### 5-3. 復旧方針

- **目標**: 直近1週間まで復旧できればOK
- **手順**: バックアップファイルを使って復旧（詳細はSupabaseの公式手順に従う）

---

## 6. 運用アラート確認

### 6-1. 確認対象

- ダッシュボード/運用メニューの「要対応アラート」
  - 2日以上未確定の試合
  - finalized後のゴーリー整合性エラー（`SA != Saves + GA`）

### 6-2. 対応手順

1. 対象試合リンクから詳細へ移動
2. 必要なら `/edit` で値を修正
3. 修正後に再確定

---

## 7. データ出力（CSV）

### 7-1. 試合詳細CSV

1. 試合詳細画面で「CSV出力」を押す
2. 単一試合のスケーター/ゴーリー明細を保存

### 7-2. シーズン通算CSV

1. `/dashboard/stats/players` でシーズンを選択
2. 「CSV出力」を押す
3. スケーター/ゴーリー通算を保存

---

## 8. 障害対応

- Sentryでエラー通知が届いたら、まず再現性を確認
- 重大障害は運用責任者が判断して連絡

---

## 9. 簡易チェックリスト

- [ ] 招待コード配布範囲を守っている
- [ ] 確定済み試合の再開封は必要時のみ
- [ ] 要対応アラートが0件になっている
- [ ] 週次バックアップを実施した
- [ ] staff 昇格は承認済み
- [ ] Sentryの通知が届いている
